<!DOCTYPE html>
<html>
<head>
    <title>ASCII Test</title>
    <style>
        body { background: #0a0a0a; color: #eaeaea; font-family: monospace; }
        video { width: 320px; height: 240px; border: 1px solid #fff; }
        canvas { border: 1px solid #0f0; }
        pre { border: 1px solid #f00; padding: 10px; }
    </style>
</head>
<body>
    <h1>ASCII Debug Test</h1>
    <video id="video" autoplay playsinline muted></video>
    <canvas id="canvas" width="40" height="30"></canvas>
    <pre id="ascii">ASCII will appear here...</pre>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const ascii = document.getElementById('ascii');
        const charset = '@%#*+=-:. ';
        
        // Start webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
                console.log('Webcam started');
                requestAnimationFrame(render);
            })
            .catch(err => console.error('Webcam error:', err));
        
        function render() {
            if (video.readyState >= 2) {
                // Draw video to canvas
                ctx.drawImage(video, 0, 0, 40, 30);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, 40, 30);
                const data = imageData.data;
                
                // Convert to ASCII
                let asciiStr = '';
                for (let y = 0; y < 30; y++) {
                    for (let x = 0; x < 40; x++) {
                        const i = (y * 40 + x) * 4;
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        const lum = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
                        const charIndex = Math.floor(lum * (charset.length - 1));
                        asciiStr += charset[charIndex];
                    }
                    asciiStr += '\\n';
                }
                
                ascii.textContent = asciiStr;
            }
            
            requestAnimationFrame(render);
        }
    </script>
</body>
</html>
</parameter>
</invoke>
